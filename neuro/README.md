# Circadian Phase Reconstruction Engine

**Repository:** https://github.com/Yungsterjoey/circadian-phase-reconstruction/tree/master/neuro
**Status:** Software-only. Advisory use. Not validated for clinical decision-making.

---

This is a software tool that estimates a person's circadian phase — where their biological clock sits within the 24-hour cycle — using sleep timing alone. No melatonin measurement, wearable sensor, or laboratory assay is required. The algorithm maintains a phase estimate that advances at the population-mean free-running period (τ = 24.2 h) and corrects it each time a sleep onset or wake time is recorded, using a Bayesian filter with a gain that scales by signal type (sleep > light > caffeine). Phase wrapping is handled on the circle so errors do not accumulate at the 0/24 h boundary. Outputs are: estimated phase in radians (convertible to an equivalent clock time), a confidence score that decays exponentially in the absence of new observations, and a qualitative label (ACTIVATION / BALANCE / BRAKE / RESET). The code is a single Node.js file with no external dependencies. It is designed to be embedded in a larger data pipeline, not used as a standalone product.

Validation against the MMASH dataset (N = 20 subjects) used sleep onset as a DLMO proxy — DLMO estimated as sleep onset minus 2 hours, per Benloucif et al. (2005). Mean absolute error against this proxy: **0.29 h** (17 min). Mean signed error: +0.23 h (model leads by 14 min; near-zero systematic bias). Maximum individual error: 1.00 h (subject 9). Sensitivity analysis across 60 combinations of free-running period, confidence decay rate, and correction gain produced a worst-case phase deviation of 1.40 h. To isolate the contribution of the Bayesian correction, an ablation was run against the Blume et al. (2024) melatonin dataset (46 observations, 16 subjects), which contains real DLMO timestamps but no sleep timing data. Without sleep input, the engine free-runs from a fixed prior and produces a mean absolute error of 3.33 h — confirming that the sleep-onset correction is load-bearing, not the free-running propagation. Validation against threshold-based DLMO ground truth (SANDD dataset, 94 subjects, 380 DLMO observations) is pending DAUA approval.

The engine requires Node.js (v18 or later) and no additional packages. To reproduce the test suite (15 unit and integration tests): `node circadian_model.test.js`. To reproduce the MMASH DLMO validation: `node mmash_validation.js` (MMASH dataset required in `data/mmash/`). To reproduce the Blume 2024 ablation: `node blume_validation.js` (data required in `data/blume2024/Data/`). To use the engine programmatically: import `circadian_model.js`, call `model.update(type, timestamp)` with each sleep or light observation, and query `model.getCurrentPhase(timestamp)` at any point. Full API and mathematical derivation are in `circadian_model_math.md`.

Three extensions are planned. First, individual free-running period estimation: the current engine uses a fixed population-mean τ; augmenting the filter with τ as a latent variable could infer individual period from residual sleep-onset patterns across multiple cycles, which would reduce the 1.40 h worst-case sensitivity observed in the parameter sweep. Second, calibrated uncertainty: the current confidence score is a heuristic exponential decay; propagating a proper wrapped distribution on the circle would yield interpretable credible intervals on the phase estimate rather than a unitless scalar. Third, independent dataset validation: the SANDD cohort provides real threshold-based DLMO timestamps from actigraphy, enabling replication against ground truth rather than the population-regression proxy used in the MMASH validation.
